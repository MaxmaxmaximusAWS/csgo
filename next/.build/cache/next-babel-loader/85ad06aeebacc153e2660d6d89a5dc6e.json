{"ast":null,"code":"var _jsxFileName=\"C:\\\\localhost\\\\csshot\\\\web\\\\components\\\\RefsPage\\\\RefsPage.js\";import React from\"react\";var __jsx=React.createElement;function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true});}else{obj[key]=value;}return obj;}import Page from\"../Widgets/Page\";import{useState}from\"react\";import Button from\"../Widgets/Button\";import{useQuery,useSubscription,useMutation,useApolloClient}from'@apollo/react-hooks';function useLiveQuery(){const{0:first,1:setFirst}=useState(true);if(first){setFirst(false);return useQuery(GET_MESSAGES);}return useSubscription(GET_MESSAGES_SUB);}const GET_MESSAGES={\"kind\":\"Document\",\"definitions\":[{\"kind\":\"OperationDefinition\",\"operation\":\"query\",\"variableDefinitions\":[],\"directives\":[],\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"message\"},\"arguments\":[],\"directives\":[],\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"id\"},\"arguments\":[],\"directives\":[]},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"text\"},\"arguments\":[],\"directives\":[]}]}}]}}],\"loc\":{\"start\":0,\"end\":55,\"source\":{\"body\":\"\\n  query {\\n    message {\\n      id\\n      text\\n    }\\n  }\\n\",\"name\":\"GraphQL request\",\"locationOffset\":{\"line\":1,\"column\":1}}}};const GET_MESSAGES_SUB={\"kind\":\"Document\",\"definitions\":[{\"kind\":\"OperationDefinition\",\"operation\":\"subscription\",\"variableDefinitions\":[],\"directives\":[],\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"message\"},\"arguments\":[],\"directives\":[],\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"id\"},\"arguments\":[],\"directives\":[]},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"text\"},\"arguments\":[],\"directives\":[]}]}}]}}],\"loc\":{\"start\":0,\"end\":62,\"source\":{\"body\":\"\\n  subscription {\\n    message {\\n      id\\n      text\\n    }\\n  }\\n\",\"name\":\"GraphQL request\",\"locationOffset\":{\"line\":1,\"column\":1}}}};const DELETE_MESSAGE={\"kind\":\"Document\",\"definitions\":[{\"kind\":\"OperationDefinition\",\"operation\":\"mutation\",\"variableDefinitions\":[{\"kind\":\"VariableDefinition\",\"variable\":{\"kind\":\"Variable\",\"name\":{\"kind\":\"Name\",\"value\":\"id\"}},\"type\":{\"kind\":\"NonNullType\",\"type\":{\"kind\":\"NamedType\",\"name\":{\"kind\":\"Name\",\"value\":\"Int\"}}},\"directives\":[]}],\"directives\":[],\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"delete_message_by_pk\"},\"arguments\":[{\"kind\":\"Argument\",\"name\":{\"kind\":\"Name\",\"value\":\"id\"},\"value\":{\"kind\":\"Variable\",\"name\":{\"kind\":\"Name\",\"value\":\"id\"}}}],\"directives\":[],\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"id\"},\"arguments\":[],\"directives\":[]}]}}]}}],\"loc\":{\"start\":0,\"end\":81,\"source\":{\"body\":\"\\n  mutation ($id: Int!) {\\n    delete_message_by_pk(id: $id) {\\n      id\\n    }\\n  }\\n\",\"name\":\"GraphQL request\",\"locationOffset\":{\"line\":1,\"column\":1}}}};const SEND_MESSAGE={\"kind\":\"Document\",\"definitions\":[{\"kind\":\"OperationDefinition\",\"operation\":\"mutation\",\"variableDefinitions\":[{\"kind\":\"VariableDefinition\",\"variable\":{\"kind\":\"Variable\",\"name\":{\"kind\":\"Name\",\"value\":\"text\"}},\"type\":{\"kind\":\"NamedType\",\"name\":{\"kind\":\"Name\",\"value\":\"String\"}},\"directives\":[]}],\"directives\":[],\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"insert_message_one\"},\"arguments\":[{\"kind\":\"Argument\",\"name\":{\"kind\":\"Name\",\"value\":\"object\"},\"value\":{\"kind\":\"ObjectValue\",\"fields\":[{\"kind\":\"ObjectField\",\"name\":{\"kind\":\"Name\",\"value\":\"text\"},\"value\":{\"kind\":\"Variable\",\"name\":{\"kind\":\"Name\",\"value\":\"text\"}}}]}}],\"directives\":[],\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"id\"},\"arguments\":[],\"directives\":[]},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"text\"},\"arguments\":[],\"directives\":[]}]}}]}}],\"loc\":{\"start\":0,\"end\":101,\"source\":{\"body\":\"\\n  mutation ($text: String){\\n    insert_message_one(object: {text: $text}) {\\n      id text\\n    }\\n  }\\n\",\"name\":\"GraphQL request\",\"locationOffset\":{\"line\":1,\"column\":1}}}};function MessagesInput(){const[sendMessage]=useMutation(SEND_MESSAGE);function onSubmit(event){if(event.key!=='Enter')return;const text=event.target.value;event.target.value='';sendMessage({variables:{text},refetchQueries:[{query:GET_MESSAGES}]});}return __jsx(\"input\",{type:\"text\",onKeyDown:onSubmit,__self:this,__source:{fileName:_jsxFileName,lineNumber:69,columnNumber:10}});}function DeleteButton({id}){const[deleteMessage,status]=useMutation(DELETE_MESSAGE);function onClick(){deleteMessage({variables:{id},refetchQueries:[{query:GET_MESSAGES}]});}return __jsx(Button,{onClick:onClick,__self:this,__source:{fileName:_jsxFileName,lineNumber:83,columnNumber:10}},\"Delete \",id);}function get(){const{0:data,1:setData}=useState({});const query=useQuery(GET_MESSAGES);const sub=useSubscription(GET_MESSAGES_SUB);console.log('query',query);console.log('sub',sub);return _objectSpread(_objectSpread({},query),{},{data});}function MessagesList({sub=false}){const{loading,error,data}=get(sub);if(loading)return __jsx(\"div\",{__self:this,__source:{fileName:_jsxFileName,lineNumber:101,columnNumber:23}},\"Loading...\");if(error)return __jsx(\"div\",{__self:this,__source:{fileName:_jsxFileName,lineNumber:102,columnNumber:21}},\"Error \",error.message,\"...\");return __jsx(\"ul\",{__self:this,__source:{fileName:_jsxFileName,lineNumber:104,columnNumber:10}},data.message.map(message=>__jsx(\"li\",{key:message.id,__self:this,__source:{fileName:_jsxFileName,lineNumber:106,columnNumber:7}},__jsx(DeleteButton,{id:message.id,__self:this,__source:{fileName:_jsxFileName,lineNumber:107,columnNumber:9}}),message.text)));}export default function RefsPage(){return __jsx(Page,{__self:this,__source:{fileName:_jsxFileName,lineNumber:117,columnNumber:10}},__jsx(\"div\",{__self:this,__source:{fileName:_jsxFileName,lineNumber:118,columnNumber:5}},__jsx(MessagesInput,{__self:this,__source:{fileName:_jsxFileName,lineNumber:119,columnNumber:7}}),__jsx(MessagesList,{__self:this,__source:{fileName:_jsxFileName,lineNumber:120,columnNumber:7}})));}","map":{"version":3,"sources":["C:/localhost/csshot/web/components/RefsPage/RefsPage.js"],"names":["Page","useState","Button","useQuery","useSubscription","useMutation","useApolloClient","useLiveQuery","first","setFirst","GET_MESSAGES","GET_MESSAGES_SUB","DELETE_MESSAGE","SEND_MESSAGE","MessagesInput","sendMessage","onSubmit","event","key","text","target","value","variables","refetchQueries","query","DeleteButton","id","deleteMessage","status","onClick","get","data","setData","sub","console","log","MessagesList","loading","error","message","map","RefsPage"],"mappings":"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","sourcesContent":["import css from 'styled-jsx/css'\r\nimport Page from \"../Widgets/Page\"\r\nimport { useState } from \"react\"\r\nimport Button from \"../Widgets/Button\"\r\nimport gql from 'graphql-tag'\r\n\r\nimport {\r\n  useQuery, useSubscription, useMutation, useApolloClient\r\n} from '@apollo/react-hooks'\r\n\r\n\r\nfunction useLiveQuery() {\r\n  const [first, setFirst] = useState(true)\r\n  if (first) {\r\n    setFirst(false)\r\n    return useQuery(GET_MESSAGES)\r\n  }\r\n\r\n  return useSubscription(GET_MESSAGES_SUB)\r\n}\r\n\r\nconst GET_MESSAGES = gql`\r\n  query {\r\n    message {\r\n      id\r\n      text\r\n    }\r\n  }\r\n`\r\n\r\nconst GET_MESSAGES_SUB = gql`\r\n  subscription {\r\n    message {\r\n      id\r\n      text\r\n    }\r\n  }\r\n`\r\n\r\nconst DELETE_MESSAGE = gql`\r\n  mutation ($id: Int!) {\r\n    delete_message_by_pk(id: $id) {\r\n      id\r\n    }\r\n  }\r\n`\r\n\r\nconst SEND_MESSAGE = gql`\r\n  mutation ($text: String){\r\n    insert_message_one(object: {text: $text}) {\r\n      id text\r\n    }\r\n  }\r\n`\r\n\r\nfunction MessagesInput() {\r\n  const [sendMessage] = useMutation(SEND_MESSAGE)\r\n\r\n  function onSubmit(event) {\r\n    if (event.key !== 'Enter') return\r\n    const text = event.target.value\r\n    event.target.value = ''\r\n    sendMessage({\r\n      variables: {text},\r\n      refetchQueries: [{query: GET_MESSAGES}]\r\n    })\r\n  }\r\n\r\n  return <input type=\"text\" onKeyDown={ onSubmit }/>\r\n}\r\n\r\n\r\nfunction DeleteButton({id}) {\r\n  const [deleteMessage, status] = useMutation(DELETE_MESSAGE)\r\n\r\n  function onClick() {\r\n    deleteMessage({\r\n      variables: {id},\r\n      refetchQueries: [{query: GET_MESSAGES}]\r\n    })\r\n  }\r\n\r\n  return <Button onClick={ onClick }>Delete { id }</Button>\r\n}\r\n\r\n\r\nfunction get() {\r\n  const [data, setData] = useState({})\r\n  const query = useQuery(GET_MESSAGES)\r\n  const sub = useSubscription(GET_MESSAGES_SUB)\r\n\r\n  console.log('query', query)\r\n  console.log('sub', sub)\r\n\r\n  return {...query, data}\r\n}\r\n\r\n\r\nfunction MessagesList({sub = false}) {\r\n  const {loading, error, data} = get(sub)\r\n  if (loading) return <div>Loading...</div>\r\n  if (error) return <div>Error { error.message }...</div>\r\n\r\n  return <ul>\r\n    { data.message.map(message => (\r\n      <li key={ message.id }>\r\n        <DeleteButton id={ message.id }/>\r\n        { message.text }\r\n      </li>\r\n    )) }\r\n  </ul>\r\n}\r\n\r\nexport default function RefsPage() {\r\n\r\n\r\n  return <Page>\r\n    <div>\r\n      <MessagesInput/>\r\n      <MessagesList/>\r\n    </div>\r\n  </Page>\r\n}\r\n\r\n\r\n"]},"metadata":{},"sourceType":"module"}
