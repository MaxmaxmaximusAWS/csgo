{"ast":null,"code":"import _slicedToArray from\"@babel/runtime/helpers/esm/slicedToArray\";var _jsxFileName=\"/app/next/components/RefsPage/RefsPage.js\",_s=$RefreshSig$(),_s2=$RefreshSig$(),_s3=$RefreshSig$(),_s4=$RefreshSig$();import React from\"react\";var __jsx=React.createElement;import Page from\"../Widgets/Page\";import{useState}from\"react\";import Button from\"../Widgets/Button\";import{useMutation}from'@apollo/react-hooks';import useLiveQuery from\"../../lib/useLiveQuery\";var GET_MESSAGES={\"kind\":\"Document\",\"definitions\":[{\"kind\":\"OperationDefinition\",\"operation\":\"query\",\"variableDefinitions\":[],\"directives\":[],\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"message\"},\"arguments\":[{\"kind\":\"Argument\",\"name\":{\"kind\":\"Name\",\"value\":\"order_by\"},\"value\":{\"kind\":\"ObjectValue\",\"fields\":[{\"kind\":\"ObjectField\",\"name\":{\"kind\":\"Name\",\"value\":\"id\"},\"value\":{\"kind\":\"EnumValue\",\"value\":\"asc\"}}]}}],\"directives\":[],\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"id\"},\"arguments\":[],\"directives\":[]},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"text\"},\"arguments\":[],\"directives\":[]}]}}]}}],\"loc\":{\"start\":0,\"end\":70,\"source\":{\"body\":\"\\n  {\\n    message(order_by: {id: asc}) {\\n      id\\n      text\\n    }\\n  }\\n\",\"name\":\"GraphQL request\",\"locationOffset\":{\"line\":1,\"column\":1}}}};var DELETE_MESSAGE={\"kind\":\"Document\",\"definitions\":[{\"kind\":\"OperationDefinition\",\"operation\":\"mutation\",\"variableDefinitions\":[{\"kind\":\"VariableDefinition\",\"variable\":{\"kind\":\"Variable\",\"name\":{\"kind\":\"Name\",\"value\":\"id\"}},\"type\":{\"kind\":\"NonNullType\",\"type\":{\"kind\":\"NamedType\",\"name\":{\"kind\":\"Name\",\"value\":\"Int\"}}},\"directives\":[]}],\"directives\":[],\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"delete_message_by_pk\"},\"arguments\":[{\"kind\":\"Argument\",\"name\":{\"kind\":\"Name\",\"value\":\"id\"},\"value\":{\"kind\":\"Variable\",\"name\":{\"kind\":\"Name\",\"value\":\"id\"}}}],\"directives\":[],\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"id\"},\"arguments\":[],\"directives\":[]}]}}]}}],\"loc\":{\"start\":0,\"end\":81,\"source\":{\"body\":\"\\n  mutation ($id: Int!) {\\n    delete_message_by_pk(id: $id) {\\n      id\\n    }\\n  }\\n\",\"name\":\"GraphQL request\",\"locationOffset\":{\"line\":1,\"column\":1}}}};var SEND_MESSAGE={\"kind\":\"Document\",\"definitions\":[{\"kind\":\"OperationDefinition\",\"operation\":\"mutation\",\"variableDefinitions\":[{\"kind\":\"VariableDefinition\",\"variable\":{\"kind\":\"Variable\",\"name\":{\"kind\":\"Name\",\"value\":\"text\"}},\"type\":{\"kind\":\"NamedType\",\"name\":{\"kind\":\"Name\",\"value\":\"String\"}},\"directives\":[]}],\"directives\":[],\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"insert_message_one\"},\"arguments\":[{\"kind\":\"Argument\",\"name\":{\"kind\":\"Name\",\"value\":\"object\"},\"value\":{\"kind\":\"ObjectValue\",\"fields\":[{\"kind\":\"ObjectField\",\"name\":{\"kind\":\"Name\",\"value\":\"text\"},\"value\":{\"kind\":\"Variable\",\"name\":{\"kind\":\"Name\",\"value\":\"text\"}}}]}}],\"directives\":[],\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"id\"},\"arguments\":[],\"directives\":[]},{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"text\"},\"arguments\":[],\"directives\":[]}]}}]}}],\"loc\":{\"start\":0,\"end\":101,\"source\":{\"body\":\"\\n  mutation ($text: String){\\n    insert_message_one(object: {text: $text}) {\\n      id text\\n    }\\n  }\\n\",\"name\":\"GraphQL request\",\"locationOffset\":{\"line\":1,\"column\":1}}}};function MessagesInput(){_s();var _useMutation=useMutation(SEND_MESSAGE),_useMutation2=_slicedToArray(_useMutation,1),sendMessage=_useMutation2[0];function onSubmit(event){if(event.key!=='Enter')return;var text=event.target.value;event.target.value='';sendMessage({variables:{text:text},refetchQueries:[{query:GET_MESSAGES}]});}return __jsx(\"input\",{type:\"text\",onKeyDown:onSubmit,__self:this,__source:{fileName:_jsxFileName,lineNumber:49,columnNumber:10}});}_s(MessagesInput,\"SytSCgrYS5McdOfvNo1dAncd7c8=\",false,function(){return[useMutation];});_c=MessagesInput;function DeleteButton(_ref){_s2();var id=_ref.id;var _useMutation3=useMutation(DELETE_MESSAGE),_useMutation4=_slicedToArray(_useMutation3,1),deleteMessage=_useMutation4[0];function onClick(){deleteMessage({variables:{id:id},refetchQueries:[{query:GET_MESSAGES}]});}return __jsx(Button,{onClick:onClick,__self:this,__source:{fileName:_jsxFileName,lineNumber:63,columnNumber:10}},\"Delete \",id);}_s2(DeleteButton,\"hkGi7a7i6lVp2j/5cv1HRdRZz9A=\",false,function(){return[useMutation];});_c2=DeleteButton;function MessagesList(){_s3();var _this=this;var _useLiveQuery=useLiveQuery(GET_MESSAGES),loading=_useLiveQuery.loading,error=_useLiveQuery.error,data=_useLiveQuery.data;if(loading)return __jsx(\"div\",{__self:this,__source:{fileName:_jsxFileName,lineNumber:69,columnNumber:23}},\"Loading...\");if(error)return __jsx(\"div\",{__self:this,__source:{fileName:_jsxFileName,lineNumber:70,columnNumber:21}},\"Error \",error.message,\"...\");return __jsx(\"ul\",{__self:this,__source:{fileName:_jsxFileName,lineNumber:72,columnNumber:10}},data.message.map(function(message){return __jsx(\"li\",{key:message.id,__self:_this,__source:{fileName:_jsxFileName,lineNumber:74,columnNumber:7}},__jsx(DeleteButton,{id:message.id,__self:_this,__source:{fileName:_jsxFileName,lineNumber:75,columnNumber:9}}),__jsx(\"span\",{__self:_this,__source:{fileName:_jsxFileName,lineNumber:76,columnNumber:9}},message.text));}));}_s3(MessagesList,\"INmSfUBQDKiFRQgArj7RI2EsIYs=\",false,function(){return[useLiveQuery];});_c3=MessagesList;var CURRENT_USER={\"kind\":\"Document\",\"definitions\":[{\"kind\":\"OperationDefinition\",\"operation\":\"query\",\"variableDefinitions\":[],\"directives\":[],\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"current_user\"},\"arguments\":[],\"directives\":[],\"selectionSet\":{\"kind\":\"SelectionSet\",\"selections\":[{\"kind\":\"Field\",\"name\":{\"kind\":\"Name\",\"value\":\"name\"},\"arguments\":[],\"directives\":[]}]}}]}}],\"loc\":{\"start\":0,\"end\":45,\"source\":{\"body\":\"\\n  {\\n    current_user {\\n      name\\n    }\\n  }\\n\",\"name\":\"GraphQL request\",\"locationOffset\":{\"line\":1,\"column\":1}}}};function CurrentUser(){_s4();var _useLiveQuery2=useLiveQuery(CURRENT_USER),loading=_useLiveQuery2.loading,error=_useLiveQuery2.error,data=_useLiveQuery2.data;if(loading)return'Loading...';if(error)return\"Error... \".concat(error.message);var user=data['current_user'][0];console.log();return __jsx(\"div\",{__self:this,__source:{fileName:_jsxFileName,lineNumber:100,columnNumber:10}},\"d\");}_s4(CurrentUser,\"INmSfUBQDKiFRQgArj7RI2EsIYs=\",false,function(){return[useLiveQuery];});_c4=CurrentUser;export default function RefsPage(){return __jsx(Page,{__self:this,__source:{fileName:_jsxFileName,lineNumber:108,columnNumber:10}},__jsx(\"div\",{__self:this,__source:{fileName:_jsxFileName,lineNumber:109,columnNumber:5}},__jsx(\"div\",{__self:this,__source:{fileName:_jsxFileName,lineNumber:110,columnNumber:7}},__jsx(CurrentUser,{__self:this,__source:{fileName:_jsxFileName,lineNumber:111,columnNumber:9}})),__jsx(MessagesInput,{__self:this,__source:{fileName:_jsxFileName,lineNumber:113,columnNumber:7}}),__jsx(MessagesList,{__self:this,__source:{fileName:_jsxFileName,lineNumber:114,columnNumber:7}})));}_c5=RefsPage;var _c,_c2,_c3,_c4,_c5;$RefreshReg$(_c,\"MessagesInput\");$RefreshReg$(_c2,\"DeleteButton\");$RefreshReg$(_c3,\"MessagesList\");$RefreshReg$(_c4,\"CurrentUser\");$RefreshReg$(_c5,\"RefsPage\");","map":{"version":3,"sources":["/app/next/components/RefsPage/RefsPage.js"],"names":["Page","useState","Button","useMutation","useLiveQuery","GET_MESSAGES","DELETE_MESSAGE","SEND_MESSAGE","MessagesInput","sendMessage","onSubmit","event","key","text","target","value","variables","refetchQueries","query","DeleteButton","id","deleteMessage","onClick","MessagesList","loading","error","data","message","map","CURRENT_USER","CurrentUser","user","console","log","RefsPage"],"mappings":"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","sourcesContent":["import css from 'styled-jsx/css'\r\nimport Page from \"../Widgets/Page\"\r\nimport { useState } from \"react\"\r\nimport Button from \"../Widgets/Button\"\r\nimport gql from 'graphql-tag'\r\nimport { useMutation } from '@apollo/react-hooks'\r\nimport useLiveQuery from \"../../lib/useLiveQuery\"\r\n\r\n\r\nconst GET_MESSAGES = gql`\r\n  {\r\n    message(order_by: {id: asc}) {\r\n      id\r\n      text\r\n    }\r\n  }\r\n`\r\n\r\n\r\nconst DELETE_MESSAGE = gql`\r\n  mutation ($id: Int!) {\r\n    delete_message_by_pk(id: $id) {\r\n      id\r\n    }\r\n  }\r\n`\r\n\r\nconst SEND_MESSAGE = gql`\r\n  mutation ($text: String){\r\n    insert_message_one(object: {text: $text}) {\r\n      id text\r\n    }\r\n  }\r\n`\r\n\r\nfunction MessagesInput() {\r\n  const [sendMessage] = useMutation(SEND_MESSAGE)\r\n\r\n  function onSubmit(event) {\r\n    if (event.key !== 'Enter') return\r\n    const text = event.target.value\r\n    event.target.value = ''\r\n    sendMessage({\r\n      variables: {text},\r\n      refetchQueries: [{query: GET_MESSAGES}]\r\n    })\r\n  }\r\n\r\n  return <input type=\"text\" onKeyDown={ onSubmit }/>\r\n}\r\n\r\n\r\nfunction DeleteButton({id}) {\r\n  const [deleteMessage] = useMutation(DELETE_MESSAGE)\r\n\r\n  function onClick() {\r\n    deleteMessage({\r\n      variables: {id},\r\n      refetchQueries: [{query: GET_MESSAGES}]\r\n    })\r\n  }\r\n\r\n  return <Button onClick={ onClick }>Delete { id }</Button>\r\n}\r\n\r\n\r\nfunction MessagesList() {\r\n  const {loading, error, data} = useLiveQuery(GET_MESSAGES)\r\n  if (loading) return <div>Loading...</div>\r\n  if (error) return <div>Error { error.message }...</div>\r\n\r\n  return <ul>\r\n    { data.message.map(message =>\r\n      <li key={ message.id }>\r\n        <DeleteButton id={ message.id }/>\r\n        <span>{ message.text }</span>\r\n      </li>\r\n    ) }\r\n  </ul>\r\n}\r\n\r\n\r\nconst CURRENT_USER = gql`\r\n  {\r\n    current_user {\r\n      name\r\n    }\r\n  }\r\n`\r\n\r\nfunction CurrentUser() {\r\n  const {loading, error, data} = useLiveQuery(CURRENT_USER)\r\n\r\n  if (loading) return 'Loading...'\r\n  if (error) return `Error... ${ error.message }`\r\n\r\n  const user = data['current_user'][0]\r\n  console.log()\r\n\r\n  return <div>\r\n    d\r\n  </div>\r\n}\r\n\r\n\r\nexport default function RefsPage() {\r\n\r\n  return <Page>\r\n    <div>\r\n      <div>\r\n        <CurrentUser/>\r\n      </div>\r\n      <MessagesInput/>\r\n      <MessagesList/>\r\n    </div>\r\n  </Page>\r\n}\r\n\r\n\r\n"]},"metadata":{},"sourceType":"module"}